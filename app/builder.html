<link rel="ractive" href="collapsible.html" name="collapsible">

<div class="mv4">
  <div class="tab-selector flex">
    <h2 class="f4 bg-near-black white mv0 pv2 ph3">Select Icons</h2>
    <h2 class="f4 gray mv0 pv2 ph3 pointer">Customize Names</h2>
    <h2 class="f4 gray mv0 pv2 ph3 pointer">Download</h2>
  </div>

  <div class="pa3 bt">
    <form>
      <input name="filter" type="search" value="{{filter}}"/>
    </form>

    {{#sets}}
    <collapsible>
      {{#partial title}}
      {{name}}
      <small class="ml3 gray fw4">
        {{version}} - License: {{license}} -
        <a href="{{homepage}}" title="Home page" target="_blank" rel="noopener">
          {{homepage}}
        </a>
      </small>
      {{/partial}}

      <div class="flex flex-wrap">
        {{#iconList}}
        <div class="icon pa3 pointer selected-{{selected}} hidden-{{hidden}}" on-click="select">
          <svg class="w-100 h-100">
            <use xlink:href="font-awesome.svg#{{name}}"/>
          </svg>
        </div>
        {{/iconList}}
      </div>
    </collapsible>
    {{/sets}}
  </div>
</div>

<style>
  .selected-true {
    border: 1px solid #36c;
  }
  .hidden-true {
    display: none;
  }
</style>

<script>
  component.exports = {
    data: () => ({
      filter: '',
      sets: []
    }),

    on: {
      select: function(e) {
        const keypath = e.get('@keypath')
        const selected = e.get('selected')
        this.set(`${keypath}.selected`, !selected)
      }
    },

    observe: {
      filter: function(value, _) {
        if (value) {
          this.get('sets').forEach((iconSet, setIndex) => {
            iconSet.iconList.forEach((icon, iconIndex) => {
              this.set(
                `sets.${setIndex}.iconList.${iconIndex}.hidden`,
                // TODO: search support synonym
                !(new RegExp(value, 'i')).test(icon.name)
              )
            })
          })
        } else {
          this.set('sets.*.iconList.*.hidden', false)
        }
      }
    }
  }
</script>
